{"version":3,"sources":["../../admin/news.js"],"names":["doc","alert","app","Alert","adminForm","AdminForm","labelItemText","labelItemsText","loadItems","fn","params","articleId","authorId","tagId","rowTmpl","rowTmplHeaders","rowTmplProps","editItem","itemId","callback","editItemCallback","saveItem","sendAsString","saveItemCallback","deleteItem","back","additionalProperties","thumbPath","thumbFileName","bannerPath","bannerFileName","ddlTags","$","_ddlTags","chosen","btnUploadImg","fUploadImg","prevImg","btnImgDelete","btnUploadImgBanner","fUploadImgBanner","prevImgBanner","btnImgBannerDelete","addEventListener","click","files","e","dataTransfer","currentTarget","file","uploadHelper","rsp","setAdditionalPropertyData","filePath","fileName","setPrevImg","value","promptAlert","dismissAlert","evt","preventDefault","setPrevImgBanner","obj","fetch","body","then","success","tags","forEach","children","tag","parseInt","opt","selected","trigger","getAdditionalPropertyData","innerHTML","classList","add","remove","push","document"],"mappings":"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","file":"news.js","sourcesContent":["ï»¿/**\r\n* Copyright 2016 Select Interactive, LLC. All rights reserved.\r\n* @author: The Select Interactive dev team (www.select-interactive.com)\r\n*/\r\n( function( doc ) {\r\n\t'use strict';\r\n\r\n\tconst alert = new app.Alert();\r\n\r\n\tlet adminForm = new app.AdminForm( {\r\n\t\tlabelItemText: 'Article',\r\n\t\tlabelItemsText: 'Articles',\r\n\t\tloadItems: {\r\n\t\t\tfn: 'articlesGetJson',\r\n\t\t\tparams: {\r\n\t\t\t\tarticleId: -1,\r\n\t\t\t\tauthorId: -1,\r\n\t\t\t\ttagId: -1\r\n\t\t\t},\r\n\t\t\trowTmpl: '<div class=\"admin-grid-row{{rowClass}}\" data-id=\"{{articleId}}\">' +\r\n\t\t\t\t\t '<div class=\"admin-grid-col admin-grid-col-primary\">{{title}}</div>' +\r\n                     '<div class=\"admin-grid-col\">{{active}}</div>' +\r\n\t\t\t\t\t '<div class=\"admin-grid-col\"><button class=\"btn btn-ripple btn-edit\">Edit</button><button class=\"btn btn-ripple btn-delete\">Delete</button></div>' +\r\n\t\t\t\t\t '</div>',\r\n\t\t\trowTmplHeaders: ['', 'Title', 'Active'],\r\n\t\t\trowTmplProps: ['articleId', 'title', 'active']\r\n\t\t},\r\n\t\teditItem: {\r\n\t\t\tfn: 'articlesGetJson',\r\n\t\t\tparams: {\r\n\t\t\t\tauthorId: -1,\r\n\t\t\t\ttagId: -1\r\n\t\t\t},\r\n\t\t\titemId: 'articleId',\r\n\t\t\tcallback: editItemCallback\r\n\t\t},\r\n\t\tsaveItem: {\r\n\t\t\tfn: 'articleSave',\r\n\t\t\titemId: 'articleId',\r\n\t\t\tsendAsString: true,\r\n\t\t\tcallback: saveItemCallback\r\n\t\t},\r\n\t\tdeleteItem: {\r\n\t\t\tfn: 'articleDelete',\r\n\t\t\titemId: 'articleId'\r\n\t\t},\r\n\t\tback: {\r\n\t\t\tfn: back\r\n\t\t},\r\n\t\tadditionalProperties: {\r\n\t\t\tthumbPath: '',\r\n\t\t\tthumbFileName: '',\r\n\t\t\tbannerPath: '',\r\n\t\t\tbannerFileName: ''\r\n\t\t}\r\n\t} );\r\n\r\n\tconst ddlTags = app.$( '#ddl-tags' );\r\n\tconst _ddlTags = $( ddlTags );\r\n\r\n\t_ddlTags.chosen();\r\n\r\n\tconst btnUploadImg = app.$( '#btn-upload-img' );\r\n\tconst fUploadImg = app.$( '#f-upload-img' );\r\n\tconst prevImg = app.$( '#prev-img' );\r\n\tconst btnImgDelete = app.$( '#btn-img-delete' );\r\n\r\n\tconst btnUploadImgBanner = app.$( '#btn-upload-img-banner' );\r\n\tconst fUploadImgBanner = app.$( '#f-upload-img-banner' );\r\n\tconst prevImgBanner = app.$( '#prev-img-banner' );\r\n\tconst btnImgBannerDelete = app.$( '#btn-img-banner-delete' );\r\n\r\n\tbtnUploadImg.addEventListener( 'click', e => fUploadImg.click() );\r\n\r\n\tfUploadImg.addEventListener( 'change', e => {\r\n\t\tlet files = e.dataTransfer ? e.dataTransfer.files : e.currentTarget.files,\r\n\t\t\tfile = files[0];\r\n\r\n\t\tadminForm.uploadHelper( file, true, '/admin/uploadImg.ashx', {\r\n\t\t\t'X-Min-Width': 600,\r\n\t\t\t'X-Min-Height': 480,\r\n\t\t\t'X-File-Path': 'img/news/thumb/'\r\n\t\t}, rsp => {\r\n\t\t\tif ( rsp ) {\r\n\t\t\t\tadminForm.setAdditionalPropertyData( 'thumbPath', rsp.filePath );\r\n\t\t\t\tadminForm.setAdditionalPropertyData( 'thumbFileName', rsp.fileName );\r\n\t\t\t\tsetPrevImg( rsp.filePath );\r\n\t\t\t}\r\n\r\n\t\t\tfUploadImg.value = '';\r\n\t\t} );\r\n\t} );\r\n\r\n\tbtnImgDelete.addEventListener( 'click', e => {\r\n\t\talert.promptAlert( 'Confirm Delete', '<p>Are you sure you want to delete this image?', 'Delete', 'Cancel', evt => {\r\n\t\t\tadminForm.setAdditionalPropertyData( 'thumbPath', '' );\r\n\t\t\tadminForm.setAdditionalPropertyData( 'thumbFileName', '' );\r\n\t\t\tsetPrevImg( '' );\r\n\t\t\talert.dismissAlert();\r\n\t\t\tevt.preventDefault();\r\n\t\t}, evt => {\r\n\t\t\talert.dismissAlert();\r\n\t\t\tevt.preventDefault();\r\n\t\t} );\r\n\t} );\r\n\r\n\tbtnUploadImgBanner.addEventListener( 'click', e => fUploadImgBanner.click() );\r\n\r\n\tfUploadImgBanner.addEventListener( 'change', e => {\r\n\t\tlet files = e.dataTransfer ? e.dataTransfer.files : e.currentTarget.files,\r\n\t\t\tfile = files[0];\r\n\r\n\t\tadminForm.uploadHelper( file, true, '/admin/uploadImg.ashx', {\r\n\t\t\t'X-Min-Width': 2000,\r\n\t\t\t'X-Min-Height': 600,\r\n\t\t\t'X-File-Path': 'img/news/banner/'\r\n\t\t}, rsp => {\r\n\t\t\tif ( rsp ) {\r\n\t\t\t\tadminForm.setAdditionalPropertyData( 'bannerPath', rsp.filePath );\r\n\t\t\t\tadminForm.setAdditionalPropertyData( 'bannerFileName', rsp.fileName );\r\n\t\t\t\tsetPrevImgBanner( rsp.filePath );\r\n\t\t\t}\r\n\r\n\t\t\tfUploadImgBanner.value = '';\r\n\t\t} );\r\n\t} );\r\n\r\n\tbtnImgBannerDelete.addEventListener( 'click', e => {\r\n\t\talert.promptAlert( 'Confirm Delete', '<p>Are you sure you want to delete this image?', 'Delete', 'Cancel', evt => {\r\n\t\t\tadminForm.setAdditionalPropertyData( 'bannerPath', '' );\r\n\t\t\tadminForm.setAdditionalPropertyData( 'bannerFileName', '' );\r\n\t\t\tsetPrevImgBanner( '' );\r\n\t\t\talert.dismissAlert();\r\n\t\t\tevt.preventDefault();\r\n\t\t}, evt => {\r\n\t\t\talert.dismissAlert();\r\n\t\t\tevt.preventDefault();\r\n\t\t} );\r\n\t} );\r\n\r\n\tfunction editItemCallback( obj ) {\r\n\t\tapp.$.fetch( '/api/articlesTagsGetJson', {\r\n\t\t\tbody: {\r\n\t\t\t\ttagId: -1,\r\n\t\t\t\tarticleId: obj.articleId\r\n\t\t\t}\r\n\t\t} ).then( rsp => {\r\n\t\t\tif ( rsp.success ) {\r\n\t\t\t\tlet tags = rsp.obj;\r\n\r\n\t\t\t\ttags.forEach( tag => {\r\n\t\t\t\t\tapp.$.forEach( ddlTags.children, opt => {\r\n\t\t\t\t\t\tif ( tag.tagId === parseInt( opt.value, 10 ) ) {\r\n\t\t\t\t\t\t\topt.selected = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t_ddlTags.trigger( 'chosen:updated' );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tsetPrevImg( adminForm.getAdditionalPropertyData( 'thumbPath' ) );\r\n\t\tsetPrevImgBanner( adminForm.getAdditionalPropertyData( 'bannerPath' ) );\r\n\t}\r\n\r\n\tfunction setPrevImg( filePath ) {\r\n\t\tif ( filePath === '' ) {\r\n\t\t\tprevImg.innerHTML = '';\r\n\t\t\tbtnImgDelete.classList.add( 'hidden' );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tprevImg.innerHTML = '<img src=\"' + filePath + '\" />';\r\n\t\tbtnImgDelete.classList.remove( 'hidden' );\r\n\t}\r\n\r\n\tfunction setPrevImgBanner( filePath ) {\r\n\t\tif ( filePath === '' ) {\r\n\t\t\tprevImgBanner.innerHTML = '';\r\n\t\t\tbtnImgBannerDelete.classList.add( 'hidden' );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tprevImgBanner.innerHTML = '<img src=\"' + filePath + '\" />';\r\n\t\tbtnImgBannerDelete.classList.remove( 'hidden' );\r\n\t}\r\n\r\n\tfunction saveItemCallback() {\r\n\t\tlet tags = [];\r\n\r\n\t\tapp.$.forEach( ddlTags.children, opt => {\r\n\t\t\tif ( opt.selected ) {\r\n\t\t\t\ttags.push( opt.value );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tapp.$.fetch( '/api/articleTagsAssign', {\r\n\t\t\tbody: {\r\n\t\t\t\tarticleId: adminForm.itemId,\r\n\t\t\t\ttags: tags\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\tfunction back() {\r\n\t\tapp.$.forEach( ddlTags.children, opt => {\r\n\t\t\topt.selected = false;\r\n\t\t} );\r\n\r\n\t\t_ddlTags.trigger( 'chosen:updated' );\r\n\r\n\t\tsetPrevImg( '' );\r\n\t\tsetPrevImgBanner( '' );\r\n\t}\r\n\r\n}( document ) );"]}