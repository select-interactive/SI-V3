"use strict";!function(a){function b(a){app.$.fetch("/api/articlesTagsGetJson",{body:{tagId:-1,articleId:a.articleId}}).then(function(a){if(a.success){var b=a.obj;b.forEach(function(a){app.$.forEach(i.children,function(b){a.tagId===parseInt(b.value,10)&&(b.selected=!0)})}),j.trigger("chosen:updated")}}),c(h.getAdditionalPropertyData("thumbPath")),d(h.getAdditionalPropertyData("bannerPath"))}function c(a){return""===a?(m.innerHTML="",void n.classList.add("hidden")):(m.innerHTML='<img src="'+a+'" />',void n.classList.remove("hidden"))}function d(a){return""===a?(q.innerHTML="",void r.classList.add("hidden")):(q.innerHTML='<img src="'+a+'" />',void r.classList.remove("hidden"))}function e(){var a=[];app.$.forEach(i.children,function(b){b.selected&&a.push(b.value)}),app.$.fetch("/api/articleTagsAssign",{body:{articleId:h.itemId,tags:a}})}function f(){app.$.forEach(i.children,function(a){a.selected=!1}),j.trigger("chosen:updated"),c(""),d("")}var g=new app.Alert,h=new app.AdminForm({labelItemText:"Article",labelItemsText:"Articles",loadItems:{fn:"articlesGetJson",params:{articleId:-1,authorId:-1,tagId:-1},rowTmpl:'<div class="admin-grid-row{{rowClass}}" data-id="{{articleId}}"><div class="admin-grid-col admin-grid-col-primary">{{title}}</div><div class="admin-grid-col">{{active}}</div><div class="admin-grid-col"><button class="btn btn-ripple btn-edit">Edit</button><button class="btn btn-ripple btn-delete">Delete</button></div></div>',rowTmplHeaders:["","Title","Active"],rowTmplProps:["articleId","title","active"]},editItem:{fn:"articlesGetJson",params:{authorId:-1,tagId:-1},itemId:"articleId",callback:b},saveItem:{fn:"articleSave",itemId:"articleId",sendAsString:!0,callback:e},deleteItem:{fn:"articleDelete",itemId:"articleId"},back:{fn:f},additionalProperties:{thumbPath:"",thumbFileName:"",bannerPath:"",bannerFileName:""}}),i=app.$("#ddl-tags"),j=$(i);j.chosen();var k=app.$("#btn-upload-img"),l=app.$("#f-upload-img"),m=app.$("#prev-img"),n=app.$("#btn-img-delete"),o=app.$("#btn-upload-img-banner"),p=app.$("#f-upload-img-banner"),q=app.$("#prev-img-banner"),r=app.$("#btn-img-banner-delete");k.addEventListener("click",function(a){return l.click()}),l.addEventListener("change",function(a){var b=a.dataTransfer?a.dataTransfer.files:a.currentTarget.files,d=b[0];h.uploadHelper(d,!0,"/admin/uploadImg.ashx",{"X-Min-Width":600,"X-Min-Height":480,"X-File-Path":"img/news/thumb/"},function(a){a&&(h.setAdditionalPropertyData("thumbPath",a.filePath),h.setAdditionalPropertyData("thumbFileName",a.fileName),c(a.filePath)),l.value=""})}),n.addEventListener("click",function(a){g.promptAlert("Confirm Delete","<p>Are you sure you want to delete this image?","Delete","Cancel",function(a){h.setAdditionalPropertyData("thumbPath",""),h.setAdditionalPropertyData("thumbFileName",""),c(""),g.dismissAlert(),a.preventDefault()},function(a){g.dismissAlert(),a.preventDefault()})}),o.addEventListener("click",function(a){return p.click()}),p.addEventListener("change",function(a){var b=a.dataTransfer?a.dataTransfer.files:a.currentTarget.files,c=b[0];h.uploadHelper(c,!0,"/admin/uploadImg.ashx",{"X-Min-Width":2e3,"X-Min-Height":600,"X-File-Path":"img/news/banner/"},function(a){a&&(h.setAdditionalPropertyData("bannerPath",a.filePath),h.setAdditionalPropertyData("bannerFileName",a.fileName),d(a.filePath)),p.value=""})}),r.addEventListener("click",function(a){g.promptAlert("Confirm Delete","<p>Are you sure you want to delete this image?","Delete","Cancel",function(a){h.setAdditionalPropertyData("bannerPath",""),h.setAdditionalPropertyData("bannerFileName",""),d(""),g.dismissAlert(),a.preventDefault()},function(a){g.dismissAlert(),a.preventDefault()})})}(document);