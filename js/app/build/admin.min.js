app.admin=function(a){"use strict";function b(b,f,g,h,i){F&&G&&(z=a.getElementById("ddl-options"),A=G.querySelectorAll(".req"),B=G.querySelectorAll("[name]"),v=b,D=app.util.extend(D,f),w=h,x=app.util.cloneObj(h),y=i,E=E.concat(g),c(),d(),e())}function c(){Parse.initialize(D.appId,D.jsKey),p()}function d(){window.forEachElement(G.querySelectorAll("textarea"),function(a){CKEDITOR.replace(a.name,C)})}function e(){z.addEventListener("change",g,!1),E.forEach(function(a){a.el&&a.evtName&&a.handler&&a.el.addEventListener(a.evtName,a.handler,!1)}),window.forEachElement(B,function(a){a.addEventListener("keypress",function(a){13===a.keyCode&&y()},!1)}),window.forEachElement(a.querySelectorAll(".input-date"),function(a){a.addEventListener("keydown",function(a){var b=a.keyCode;(48>b||b>57)&&(96>b||b>105)&&46!==b&&37!==b&&39!==b&&8!==b&&111!==b&&191!==b&&9!==b&&a.preventDefault()},!1),a.addEventListener("keyup",function(a){var b=this.value.trim();2!==b.length&&5!==b.length||8===a.keyCode||(this.value=b+"/")})})}function f(){F.classList.add("hidden"),G.classList.remove("hidden"),a.querySelector('[name="sortOrder"]')&&(a.querySelector('[name="sortOrder"]').value=z.querySelectorAll("option").length),app.forms.checkActive(),G.querySelector("input").focus(),u()}function g(){var b,c,d=Parse.Object.extend(D.object),e=new Parse.Query(d);v.itemId=z.options[z.selectedIndex].value,"-1"!==v.itemId.length&&(t("Loading, please wait."),e.get(v.itemId,{success:function(d){if(d){if(window.forEachElement(B,function(a){var b=d.get(a.getAttribute("name"));"textarea"===a.tagName.toLowerCase()&&CKEDITOR.instances[a.id].setData(b),a.classList.contains("input-date")?a.value=moment(b).format("MM/DD/YYYY"):a.value=b}),w){b=Object.keys(w);for(var e=0;e<b.length;e++)c=b[e],h(c,d.get(c))}v.load.callback&&"function"==typeof v.load.callback&&v.load.callback(),F.classList.add("hidden"),G.classList.remove("hidden"),v.del&&a.getElementById("btn-item-delete").classList.remove("hidden"),u()}else t("Unable to load data. Please try again."),z.value="-1"},error:function(a,b){console.log(a,b)}}))}function h(a,b){w[a]=b}function i(a){return w[a]}function j(){var a=!0;return window.forEachElement(A,function(b){var c;c="textarea"===b.tagName.toLowerCase()?CKEDITOR.instances[b.id].getData(c).trim():"select"!==b.tagName.toLowerCase()||b.classList.contains("material-select")?b.value.trim():b.options[b.selectedIndex].value,""===c||"-1"===c?(b.classList.add("invalid"),a=!1):(b.value=c,b.classList.remove("invalid"))}),a?u():(G.querySelector(".invalid").focus(),t("Fields marked with * are required.")),a}function k(){var a,b,c={};if(window.forEachElement(B,function(a){var b;b="textarea"===a.tagName.toLowerCase()?CKEDITOR.instances[a.id].getData(b).trim():"select"!==a.tagName.toLowerCase()||a.classList.contains("material-select")?a.value.trim():a.options[a.selectedIndex].value,c[a.getAttribute("name")]=b}),w){a=Object.keys(w);for(var d=0;d<a.length;d++)b=a[d],c[b]=i(b)}return c}function l(a,b,c,d){var e=a?a.name:"",f=a?a.type:"",g=new FileReader;(""!==e||""!==f)&&(!b||/^image\//.test(f)?(t("Uploading, please wait. This could take a few minutes."),g.onload=function(b){var g=new XMLHttpRequest;g.open("post",c,!0),g.setRequestHeader("X-File-Name",e),g.setRequestHeader("X-File-Size",a.size),g.setRequestHeader("X-File-Type",f),g.addEventListener("load",function(a){if(a.target.response){var b,c=JSON.parse(a.target.response);"success"===c.status?(t("The file was successfully uploaded."),setTimeout(u,1e3),d&&"function"==typeof d&&d(c.fileName)):(b="Unable to upload the file, please try again.",c.msg&&(b+=" "+c.msg),t(b))}},!1),g.send(a)},g.readAsDataURL(a)):t("Only .jpg, .jpeg, and .png files are allowed."))}function m(a,b,c){var d=Parse.Object.extend(D.object),e=new d,f=!1,g=function(){e.save(b,{success:function(a){t("Save successful."),p(),c&&"function"==typeof c&&c(a),setTimeout(o,1e3)},error:function(a,b){t("Unable to save at this time, please try again."),console.log(a,b)}})};if(t("Saving, please wait..."),-1!==s()){var h=new Parse.Query(d);h.get(v.itemId,{success:function(a){e=a,g()},error:function(a,b){f=!0,t("Unable to save at this tieme, please try again.")}})}else g()}function n(){var a=Parse.Object.extend(D.object),b=new Parse.Query(a);v.itemId=z.options[z.selectedIndex].value,"-1"!==v.itemId.length&&window.confirm("Are you sure you want to delete this item?")&&(t("Loading, please wait."),b.get(v.itemId,{success:function(a){a.destroy({success:function(a){t("The item has been deleted successfully."),p(),setTimeout(o,1e3)},error:function(a,b){t("Unable to delete at this time, please try again."),console.log(a,b)}})},error:function(a,b){t("Unable to delete at this time, please try again."),console.log(a,b)}}))}function o(){v.itemId=-1,w=app.util.cloneObj(x),z.value="-1",window.scrollTo(0,0),G.classList.add("hidden"),F.classList.remove("hidden"),window.forEachElement(G.querySelectorAll("input, textarea"),function(a){"textarea"===a.tagName.toLowerCase()?CKEDITOR.instances[a.id].setData(""):(a.classList.remove("invalid"),a.value="")}),window.forEachElement(G.querySelectorAll("select"),function(a){a.classList.remove("invalid"),a.value="-1",a.classList.contains("material-select")?(a.parentNode.querySelector('input[type="text"]').value="",a.parentNode.querySelector('input[type="text"]').classList.remove("invalid"),window.forEachElement(a.parentNode.querySelectorAll(".select-opt.active"),function(a){a.classList.remove("active")})):a.multiple&&a.classList.contains("chosen-select")&&(window.forEachElement(a.querySelectorAll("option"),function(a){a.selected=!1}),$(a).trigger("chosen:updated"))}),window.forEachElement(G.querySelectorAll(".row-preview"),function(a){a.innerHTML=""}),window.forEachElement(G.querySelectorAll(".row-map"),function(a){a.classList.add("hidden")}),forEachElement(a.querySelectorAll(".btn-load-action"),function(a){a.classList.add("hidden")}),forEachElement(G.querySelectorAll(".active"),function(a){a.classList.remove("active")}),a.getElementById("btn-item-delete").classList.add("hidden"),u()}function p(){var a=Parse.Object.extend(D.object),b=new Parse.Query(a);D.querySort&&b.ascending(D.querySort),b.limit(1e3),b.find({success:function(a){var b;if(z.innerHTML="",a&&a.length){z.appendChild(q("-1","-- Select "+v.item+" --"));for(var c=0;c<a.length;c++)b=a[c],z.appendChild(q(b.id,v.setOptionText(b)))}else z.appendChild(q("-1","-- No "+v.item+"s Found --"))},error:function(a,b){console.log(a,b)}})}function q(b,c,d){var e=a.createElement("option");return e.value=b,e.text=c,d&&(e.className=d),e}function r(a,b){var c;return a=a.toLowerCase(),a=a.replace(/ /gi,"-"),a=a.replace(/#/gi,"-"),a=a.replace(/!/gi,"-"),a=a.replace(/&/gi,"-"),a=a.replace(/\./gi,""),a=a.replace(/,/gi,""),a=a.replace(/'/gi,""),a=a.replace(/"/gi,""),a=a.replace(/\//gi,""),a=a.replace(/\\/gi,""),a=a.replace(/--/gi,"-"),b&&(c=b.substring(6)+"/",c=c+b.substring(0,2)+"/",c=c+b.substring(3,5)+"/",a=c+a),a}function s(){return v.itemId}function t(a){app.toast.show(a)}function u(){app.toast.hide()}var v,w,x,y,z,A,B,C={allowedContent:!0,height:350,toolbar:"Simple"},D={appId:"caIzDF1iPPqqdTRXaKeC83tblCsx8tDpSchvTPkz",jsKey:"tW8R8E8XU0LqkWAm1npm6ImkWqW5HztS61rXnXhB"},E=[{el:a.getElementById("btn-item-new"),evtName:"click",handler:f},{el:a.getElementById("btn-item-back"),evtName:"click",handler:o},{el:a.getElementById("btn-item-delete"),evtName:"click",handler:n}],F=a.getElementById("form-options"),G=a.getElementById("form-edit");a.getElementById("status");return{init:b,initItem:f,back:o,setOtherDataProperty:h,getOtherDataProperty:i,validateReqFields:j,collectData:k,getItemId:s,uploadFile:l,saveItem:m,deleteItem:n,createOpt:q,createUrl:r,setStatus:t,clearStatus:u,updateOptions:p,getParseAppId:D.appId,getParseJSKey:D.jsKey}}(document);